# 3.6 가변 데이터

코드의 다른 곳에서는 다른 값을 기대한다는 사실을 인식하지 못한 채 수정해버리면 프로그램이 오작동한다. 함부로 데이터를 변경하게 되면 골치 아픈 버그로 이어지는 것이다.

이러한 이유로 함수형 프로그래밍에서는 데이터는 절대 변하지 않고, **데이터를 변경하려면 반드시 (원래 데이터는 그대로 둔 채) 변경하려는 값에 해당하는 복사본을 만들어서 반환한다는 개념을 기본으로 삼고 있다.**

### 1. 변수 캡슐화하기

- 정해놓은 함수를 거쳐야만 값을 수정할 수 있도록 하면 값이 어떻게 수정되는지 감시하거나 코드를 개선하기 쉽다.

### 2. 변수 쪼개기

- 하나의 변수에 용도가 다른 값들을 저장하느라 값을 갱신하는 경우에 유용하다. 용도 별로 **독립 변수에 저장**하게 하여 값 갱신이 문제를 일으킬 여지를 없앤다.
  - 갱신 로직은 다른 코드와 떨어뜨려 놓는 것이 좋다.
  - **문장 슬라이드하기, 함수 추출하기를 이용하여 무언가를 갱신하는 코드로부터 부작용이 없는 코드를 분리**한다.

### 3. 질의 함수와 변경 함수 분리하기

- API를 만들 때, 꼭 필요한 경우가 아니라면 부작용이 있는 코드를 호출할 수 없게 만든다.

  - **세터 제거하기**도 가능한 적용하는 것이 좋다. 간혹, setter를 호출하는 클라이언트를 찾는 것만으로도 변수의 유효범위를 줄이는 데 도움이 된다.

### 4. 파생 변수를 질의 함수로 바꾸기

- 값을 다른 곳에서 설정할 수 있는 가변 데이터가 풍기는 악취는 야근을 초래하고 쓸데 없는 코드이기도 하다. 질의 함수로 변경하여 코드 전체에 뿌린다.

### 5. 여러 함수를 클래스로 묶기 or 여러 함수를 변환 함수로 묶기

- 변수의 유효범위가 단 몇 줄뿐이라면 가변 데이터라 해도 문제를 일으킬 일이 없을 수 있지만, 나중에 유효범위의 범위가 커질 수 있다.
- 따라서 **변수를 갱신하는 코드들의 유효범위를 클래스나 변환으로 제한**한다.

### 6. 참조를 값으로 바꾸기

- 구조체처럼 내부 필드에 데이터를 담고 있는 변수라면, 내부 필드를 직접 수정하지 말고 구조체를 통째로 교체하는 편이 낫다.
