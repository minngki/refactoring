# 리팩터링 원칙

## 2.1 리팩터링 정의

**리팩터링(N)**: 소프트웨어의 겉보기 동작은 그대로 유지한 채, **코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법**

- 함수 추출하기 (6.1절)
- 조건부 로직을 다형성으로 바꾸기(10.4절)

> 💡 겉보기 동작: 리팩터링 하기 전과 후의 코드가 똑같이 동작해야 한다.

**리팩터링(V)**: 소프트웨어의 겉보기 동작은 그대로 유지한 채, **여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.**

- 코드베이스를 정리하거나 구조를 바꾸는 모든 작업은 재구성이라는 포괄적인 용어로 표현하고, 리팩터링은 재구성 중 특수한 형태라 볼 수 있다.
- 성능 최적화와 유사하지만 목적이 다르다. 둘 다 프로그램의 전반적인 기능은 유지하지만 성능 최적화의 목적은 오로지 속도개선에만 초점을 두고, 리팩터링의 목적은 코드를 이해하고 수정하기 쉽게 만드는 것이다.

## 2.2 두 개의 모자

> '기능 추가'와 '리팩터링' ?

1. 기능 추가

- 기존 코드는 절대 건드리지 않고 새 기능을 추가하기만 한다.
- 진척도는 테스트를 추가해서 확인하는 방식으로 측정한다.

2. 리팩터링

- 기능 추가는 절대 하지 않고 오로지 코드 재구성에만 전념한다.
- 테스트도 새로 만들지 않는다. (앞 과정에서 놓친 테스트 케이스를 발견하지 않는 한)

이 모자들을 자주 바꿔 쓸 수 있지만, 그 작업 방식의 차이를 분명하게 인식해두고 작업을 해야한다.

## 2.3 리팩터링 하는 이유

리팩터링이 모든 문제점의 해결 방안은 아니지만, 건강한 코드 상태로 유지할 수 있도록 하는 것은 분명하다.

#### 1. 리팩터링하면 소프트웨어 설계가 좋아진다.

리팩터링을 하지 않으면 아키텍처(내부 설계)가 썩기 쉽다. 아키텍처를 충분히 이해하지 않은 채 단기 목표만을 위해 코드 수정이 이루어진다면 기반 구조가 무너지기 쉽다. 이 경우, 코드만 봐서 설계를 이해하기 어려워진다. **즉, 코드만으로 설계를 파악하기 어려워질수록 설계를 유지하기 어려워지고, 설가 부패되는 속도는 더욱 빨라진다.**

중복 코드 제거는 설계 개선 작업의 중요한 한 축을 차지한다. 코드량을 줄인다고 시스템이 빨라지는 것은 아니다. 프로그램의 용량이 속도 개선에 영향을 주는 경우는 별로 없다.

다만, 코드량이 줄면 수정하는 데 드는 노력은 크게 달라진다. 코드가 길고 복잡할수록 이해해야하는 코드가 많다는 것이며, 비슷한 일을 하는 코드가 많을 수록 살짝 수정해도 예상대로 작동하지 않을 수 있다. 따라서 중복 코드를 제거하면 모든 코드가 언제나 고유한 일을 수행함을 보장할 수 있으며, 이는 바람직한 설계의 핵심이다.

#### 2. 리팩터링하면 소프트웨어를 이해하기 쉬워진다.

프로그래밍은 컴퓨터와 대화하는 것과 같다. 내가 원하는 바를 정확히 표현하는 일인데, 소스 코드는 컴퓨터 뿐만 아니라 다른 사람이 사용할 수도 있다. 다른 사람이 내가 될 경우가 많다. 기억할 필요가 있는 것들을 최대한 코드에 담아 관리하는 게 중요하다.

#### 3. 리팩터링하면 버그를 쉽게 찾을 수 있다.

리팩터링하면 코드가 하는 일을 깊이 파악하게 되면서 새로 깨달은 것을 곧바로 코드에 반영하게 된다. 프로그램의 구조를 명확하게 다듬으면 그냥 '이럴 것이다'라고 가정하던 점들이 분명히 드러나는데, 버그를 지나치려야 지나칠 수 없을 정도까지 명확해진다.

> 켄트 백, '난 뛰어난 프로그래머가 아니에요. 단지 뛰어난 습관을 지닌 괜찮은 프로그래머일 뿐이에요.'

#### 4. 리팩터링하면 프로그래밍 속도를 높일 수 있다.

내부 설계와 가독성이 개선되고 버그가 줄어든다는 점은 모두 품질 향상에 직결된다. 하지만 리팩터링하는 데 시간이 드니 전체 개발 속도는 떨어질까봐 걱정할 수도 있다.

초기에는 진척이 빨랐지만 현재는 새 기능을 하나 추가하는 데 훨씬 오래 걸린다는 말을 많이 한다. 새로운 기능을 추가할수록 기존 코드베이스에 잘 녹여낼 방법을 찾는 데 드는 시간이 늘어난다는 것이다. 게다가 기능을 추가하고 나면 버그가 발생하는 일이 잦고, 이를 해결하는 시간은 한층 더 걸린다.

**지구력 가설**: 내부 설계에 심혈을 기울일수록 소프트웨어의 지구력이 높아져서 빠르게 개발할 수 있는 상태를 더 오래 지속할 수 있다.

내부 설계가 잘 된 소프트웨어는 새로운 기능을 추가할 지점과 어떻게 고칠지를 쉽게 찾을 수 있다. 모듈화가 잘 되어 있으면 전체 코드베이스 중 작은 일부만 이해하면 된다. 내부 품질이 뛰어난 코드베이스는 새 기능 구축을 돕는 견고한 토대가 된다.

## 2.4 언제 리팩터링해야 할까?

거의 한 시간 간격으로 리팩터링 ?

### 3의 법칙

1. 처음에는 그냥 한다.
2. 비슷한 일을 두 번째로 하게 되면(중복이 생겼다는 사실에 당황스럽겠지만), 일단 계속 진행한다.
3. 비슷한 일을 세 번째 하게 되면 리팩터링한다.

#### 1. 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
